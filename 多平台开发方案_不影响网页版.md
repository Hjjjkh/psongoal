# å¤šå¹³å°å¼€å‘æ–¹æ¡ˆ - ä¸å½±å“ç½‘é¡µç‰ˆ

## ğŸ¯ ç›®æ ‡

å¼€å‘ **appï¼ˆiOS/Androidï¼‰**ã€**exeï¼ˆWindows/Macï¼‰**ã€**å¾®ä¿¡å°ç¨‹åº**ï¼Œä½†**ä¸å½±å“ç°æœ‰çš„æµè§ˆå™¨ç‰ˆæœ¬**ã€‚

## ğŸ“Š æ¶æ„è®¾è®¡

### æ–¹æ¡ˆï¼šå¤šå¹³å°ç‹¬ç«‹å®ç°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å…±äº«ä¸šåŠ¡é€»è¾‘å±‚                    â”‚
â”‚    (lib/core/, lib/features/)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚      â”‚          â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”
â”‚ ç½‘é¡µç‰ˆ â”‚ â”‚App â”‚ â”‚ exe â”‚ â”‚å°ç¨‹åº â”‚
â”‚       â”‚ â”‚    â”‚ â”‚     â”‚ â”‚       â”‚
â”‚Supabaseâ”‚ â”‚SQLiteâ”‚ â”‚SQLiteâ”‚ â”‚Supabaseâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ æŠ€æœ¯æ–¹æ¡ˆ

### 1. ç½‘é¡µç‰ˆï¼ˆä¿æŒç°çŠ¶ï¼‰

**æŠ€æœ¯æ ˆ**ï¼š
- Next.js 14
- Supabaseï¼ˆäº‘ç«¯æ•°æ®åº“ï¼‰
- ä¿æŒç°æœ‰ä»£ç ä¸å˜

**æ•°æ®å­˜å‚¨**ï¼š
- Supabaseï¼ˆäº‘ç«¯ï¼‰
- ä¿æŒè”ç½‘

**æ”¹åŠ¨**ï¼š**æ— **ï¼ˆå®Œå…¨ä¿æŒç°çŠ¶ï¼‰

### 2. Appï¼ˆiOS/Androidï¼‰

**æŠ€æœ¯æ ˆ**ï¼š
- React Native
- SQLiteï¼ˆæœ¬åœ°æ•°æ®åº“ï¼‰
- å®Œå…¨ç¦»çº¿

**æ•°æ®å­˜å‚¨**ï¼š
- SQLiteï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰
- ä¸éœ€è¦è”ç½‘

**å®ç°**ï¼š
- æ–°å»ºç‹¬ç«‹é¡¹ç›®ï¼ˆæˆ– monorepoï¼‰
- å…±äº«ä¸šåŠ¡é€»è¾‘ï¼ˆé€šè¿‡ npm åŒ…æˆ– git submoduleï¼‰
- ç‹¬ç«‹ UI å±‚ï¼ˆReact Native ç»„ä»¶ï¼‰

### 3. exeï¼ˆWindows/Macï¼‰

**æŠ€æœ¯æ ˆ**ï¼š
- Electron
- SQLiteï¼ˆæœ¬åœ°æ•°æ®åº“ï¼‰
- å®Œå…¨ç¦»çº¿

**æ•°æ®å­˜å‚¨**ï¼š
- SQLiteï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰
- ä¸éœ€è¦è”ç½‘

**å®ç°**ï¼š
- æ–°å»ºç‹¬ç«‹é¡¹ç›®ï¼ˆæˆ– monorepoï¼‰
- å…±äº«ä¸šåŠ¡é€»è¾‘
- ç‹¬ç«‹ UI å±‚ï¼ˆElectron + Reactï¼‰

### 4. å¾®ä¿¡å°ç¨‹åº

**æŠ€æœ¯æ ˆ**ï¼š
- åŸç”Ÿå°ç¨‹åºæ¡†æ¶
- Supabaseï¼ˆäº‘ç«¯æ•°æ®åº“ï¼‰
- ä¿æŒè”ç½‘

**æ•°æ®å­˜å‚¨**ï¼š
- Supabaseï¼ˆäº‘ç«¯ï¼‰
- ä¿æŒè”ç½‘

**å®ç°**ï¼š
- æ–°å»ºç‹¬ç«‹é¡¹ç›®
- å…±äº«ä¸šåŠ¡é€»è¾‘
- å°ç¨‹åº UI å±‚

## ğŸ“ é¡¹ç›®ç»“æ„å»ºè®®

### æ–¹æ¡ˆ A: Monorepoï¼ˆæ¨èï¼‰

```
psongoal/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/              # å…±äº«ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ system-state.ts
â”‚   â”‚   â”œâ”€â”€ insights.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”œâ”€â”€ web/               # ç½‘é¡µç‰ˆï¼ˆç°æœ‰ä»£ç ï¼‰
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ lib/
â”‚   â”œâ”€â”€ mobile/            # Appï¼ˆReact Nativeï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ database/      # SQLite
â”‚   â”œâ”€â”€ desktop/           # exeï¼ˆElectronï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ database/      # SQLite
â”‚   â””â”€â”€ miniprogram/       # å¾®ä¿¡å°ç¨‹åº
â”‚       â”œâ”€â”€ pages/
â”‚       â””â”€â”€ utils/
â””â”€â”€ package.json
```

### æ–¹æ¡ˆ B: ç‹¬ç«‹é¡¹ç›®ï¼ˆç®€å•ï¼‰

```
psongoal-web/          # ç°æœ‰é¡¹ç›®ï¼ˆä¸å˜ï¼‰
psongoal-mobile/       # App é¡¹ç›®ï¼ˆæ–°å»ºï¼‰
psongoal-desktop/      # exe é¡¹ç›®ï¼ˆæ–°å»ºï¼‰
psongoal-miniprogram/  # å°ç¨‹åºé¡¹ç›®ï¼ˆæ–°å»ºï¼‰
psongoal-core/         # å…±äº«é€»è¾‘ï¼ˆnpm åŒ…æˆ– git submoduleï¼‰
```

## ğŸ”§ å®ç°æ­¥éª¤

### é˜¶æ®µ 1: æå–å…±äº«é€»è¾‘ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**ï¼šå°†ä¸šåŠ¡é€»è¾‘ä»ç½‘é¡µç‰ˆä¸­æå–å‡ºæ¥

1. **åˆ›å»ºå…±äº«åŒ…**ï¼š
   ```typescript
   // packages/core/system-state.ts
   export async function getSystemState(userId: string) {
     // ä¸šåŠ¡é€»è¾‘ï¼ˆä¸ä¾èµ– Supabaseï¼‰
   }
   ```

2. **åˆ›å»ºæ•°æ®è®¿é—®æŠ½è±¡å±‚**ï¼š
   ```typescript
   // packages/core/db-interface.ts
   export interface DatabaseAdapter {
     getGoals(userId: string): Promise<Goal[]>
     createGoal(goal: Goal): Promise<Goal>
     // ... å…¶ä»–æ“ä½œ
   }
   ```

3. **å®ç°ä¸åŒé€‚é…å™¨**ï¼š
   ```typescript
   // ç½‘é¡µç‰ˆï¼šSupabase é€‚é…å™¨
   class SupabaseAdapter implements DatabaseAdapter {
     // ä½¿ç”¨ Supabase
   }
   
   // App/exeï¼šSQLite é€‚é…å™¨
   class SQLiteAdapter implements DatabaseAdapter {
     // ä½¿ç”¨ SQLite
   }
   ```

### é˜¶æ®µ 2: å¼€å‘ Appï¼ˆ2-3å‘¨ï¼‰

1. **åˆ›å»º React Native é¡¹ç›®**
2. **é›†æˆ SQLite**
3. **ä½¿ç”¨å…±äº«ä¸šåŠ¡é€»è¾‘**
4. **å®ç° UI å±‚**

### é˜¶æ®µ 3: å¼€å‘ exeï¼ˆ2-3å‘¨ï¼‰

1. **åˆ›å»º Electron é¡¹ç›®**
2. **é›†æˆ SQLite**
3. **ä½¿ç”¨å…±äº«ä¸šåŠ¡é€»è¾‘**
4. **å®ç° UI å±‚**

### é˜¶æ®µ 4: å¼€å‘å°ç¨‹åºï¼ˆ1-2å‘¨ï¼‰

1. **åˆ›å»ºå°ç¨‹åºé¡¹ç›®**
2. **ä½¿ç”¨ Supabaseï¼ˆå’Œç½‘é¡µç‰ˆä¸€æ ·ï¼‰**
3. **ä½¿ç”¨å…±äº«ä¸šåŠ¡é€»è¾‘**
4. **å®ç°å°ç¨‹åº UI**

## âœ… å…³é”®ç‚¹ï¼šä¸å½±å“ç½‘é¡µç‰ˆ

### 1. ç½‘é¡µç‰ˆå®Œå…¨ä¸å˜

- âœ… ä¿æŒç°æœ‰ä»£ç 
- âœ… ç»§ç»­ä½¿ç”¨ Supabase
- âœ… ä¸ä¿®æ”¹ä»»ä½•æ–‡ä»¶
- âœ… åŠŸèƒ½å®Œå…¨ä¿æŒ

### 2. å…±äº«é€»è¾‘æå–

- âœ… å°†ä¸šåŠ¡é€»è¾‘æå–åˆ°ç‹¬ç«‹åŒ…
- âœ… ç½‘é¡µç‰ˆä½¿ç”¨å…±äº«é€»è¾‘ + Supabase é€‚é…å™¨
- âœ… å…¶ä»–å¹³å°ä½¿ç”¨å…±äº«é€»è¾‘ + å„è‡ªé€‚é…å™¨

### 3. ç‹¬ç«‹é¡¹ç›®/åŒ…

- âœ… æ¯ä¸ªå¹³å°ç‹¬ç«‹é¡¹ç›®
- âœ… é€šè¿‡ npm åŒ…æˆ– git submodule å…±äº«é€»è¾‘
- âœ… äº’ä¸å½±å“

## ğŸ“‹ æ•°æ®è®¿é—®å±‚è®¾è®¡

### æŠ½è±¡æ¥å£

```typescript
// packages/core/db-interface.ts
export interface DatabaseAdapter {
  // Goals
  getGoals(userId: string): Promise<Goal[]>
  createGoal(goal: Goal): Promise<Goal>
  updateGoal(id: string, updates: Partial<Goal>): Promise<Goal>
  deleteGoal(id: string): Promise<void>
  
  // Phases
  getPhases(goalId: string): Promise<Phase[]>
  createPhase(phase: Phase): Promise<Phase>
  // ... å…¶ä»–æ“ä½œ
}
```

### ç½‘é¡µç‰ˆå®ç°

```typescript
// packages/web/lib/db/supabase-adapter.ts
export class SupabaseAdapter implements DatabaseAdapter {
  async getGoals(userId: string): Promise<Goal[]> {
    const { data } = await supabase
      .from('goals')
      .select('*')
      .eq('user_id', userId)
    return data || []
  }
  // ... å…¶ä»–å®ç°
}
```

### App/exe å®ç°

```typescript
// packages/mobile/src/db/sqlite-adapter.ts
export class SQLiteAdapter implements DatabaseAdapter {
  async getGoals(userId: string): Promise<Goal[]> {
    return db.prepare('SELECT * FROM goals WHERE user_id = ?')
      .all(userId)
  }
  // ... å…¶ä»–å®ç°
}
```

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šMonorepo + å…±äº«é€»è¾‘

**ä¼˜ç‚¹**ï¼š
- âœ… ä»£ç å…±äº«æ–¹ä¾¿
- âœ… ç»Ÿä¸€ç®¡ç†
- âœ… ç‰ˆæœ¬åŒæ­¥
- âœ… ä¸å½±å“ç½‘é¡µç‰ˆ

**ç»“æ„**ï¼š
```
packages/
â”œâ”€â”€ core/        # å…±äº«ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ web/         # ç½‘é¡µç‰ˆï¼ˆç°æœ‰ä»£ç ï¼Œå‡ ä¹ä¸å˜ï¼‰
â”œâ”€â”€ mobile/      # Appï¼ˆæ–°å»ºï¼‰
â”œâ”€â”€ desktop/     # exeï¼ˆæ–°å»ºï¼‰
â””â”€â”€ miniprogram/ # å°ç¨‹åºï¼ˆæ–°å»ºï¼‰
```

## ğŸ“ å®æ–½è®¡åˆ’

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡é˜¶æ®µï¼ˆ1å‘¨ï¼‰

1. åˆ›å»º monorepo ç»“æ„
2. å°†ç°æœ‰ä»£ç ç§»åˆ° `packages/web`
3. æå–å…±äº«é€»è¾‘åˆ° `packages/core`
4. æµ‹è¯•ç½‘é¡µç‰ˆæ˜¯å¦æ­£å¸¸

### ç¬¬äºŒæ­¥ï¼šå¼€å‘ Appï¼ˆ2-3å‘¨ï¼‰

1. åˆ›å»º `packages/mobile`
2. å®ç° SQLite é€‚é…å™¨
3. ä½¿ç”¨å…±äº«é€»è¾‘
4. å®ç° UI

### ç¬¬ä¸‰æ­¥ï¼šå¼€å‘ exeï¼ˆ2-3å‘¨ï¼‰

1. åˆ›å»º `packages/desktop`
2. å®ç° SQLite é€‚é…å™¨
3. ä½¿ç”¨å…±äº«é€»è¾‘
4. å®ç° UI

### ç¬¬å››æ­¥ï¼šå¼€å‘å°ç¨‹åºï¼ˆ1-2å‘¨ï¼‰

1. åˆ›å»º `packages/miniprogram`
2. ä½¿ç”¨ Supabaseï¼ˆå’Œç½‘é¡µç‰ˆä¸€æ ·ï¼‰
3. ä½¿ç”¨å…±äº«é€»è¾‘
4. å®ç°å°ç¨‹åº UI

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç½‘é¡µç‰ˆä¿æŒä¸å˜

- âœ… ä¸ä¿®æ”¹ç°æœ‰ä»£ç 
- âœ… ç»§ç»­ä½¿ç”¨ Supabase
- âœ… åŠŸèƒ½å®Œå…¨ä¿æŒ

### 2. å…±äº«é€»è¾‘æå–

- âœ… åªæå–ä¸šåŠ¡é€»è¾‘
- âœ… ä¸åŒ…å«å¹³å°ç‰¹å®šä»£ç 
- âœ… é€šè¿‡é€‚é…å™¨æ¨¡å¼æ”¯æŒä¸åŒæ•°æ®åº“

### 3. æ•°æ®åŒæ­¥ï¼ˆå¯é€‰ï¼‰

- å¦‚æœç”¨æˆ·éœ€è¦å¤šç«¯åŒæ­¥ï¼Œå¯ä»¥å®ç°ï¼š
  - ç½‘é¡µç‰ˆ â†” App/exe åŒæ­¥
  - é€šè¿‡å¯¼å‡º/å¯¼å…¥ JSON
  - æˆ–é€šè¿‡å¯é€‰äº‘ç«¯åŒæ­¥

## ğŸ¯ æ€»ç»“

**æ–¹æ¡ˆ**ï¼š
- ç½‘é¡µç‰ˆï¼šå®Œå…¨ä¸å˜ï¼Œç»§ç»­ä½¿ç”¨ Supabase
- App/exeï¼šæ–°å»ºé¡¹ç›®ï¼Œä½¿ç”¨ SQLiteï¼Œå®Œå…¨æœ¬åœ°
- å°ç¨‹åºï¼šæ–°å»ºé¡¹ç›®ï¼Œä½¿ç”¨ Supabaseï¼Œå’Œç½‘é¡µç‰ˆä¸€æ ·
- å…±äº«é€»è¾‘ï¼šæå–åˆ°ç‹¬ç«‹åŒ…ï¼Œæ‰€æœ‰å¹³å°å…±ç”¨

**å¥½å¤„**ï¼š
- âœ… ä¸å½±å“ç½‘é¡µç‰ˆ
- âœ… ä»£ç å¯ä»¥å…±äº«
- âœ… å„å¹³å°ç‹¬ç«‹å¼€å‘
- âœ… äº’ä¸å½±å“

**å‘Šè¯‰æˆ‘æ˜¯å¦å¼€å§‹å®æ–½ï¼Œæˆ‘ä¼šé€æ­¥å®Œæˆï¼**

