# å¤šå¹³å°å¼€å‘ã€æ‰§è¡Œå’Œéƒ¨ç½²å®Œæ•´æ–¹æ¡ˆ

## ğŸ¯ ç›®æ ‡

å¼€å‘ **appï¼ˆiOS/Androidï¼‰**ã€**exeï¼ˆWindows/Macï¼‰**ã€**å¾®ä¿¡å°ç¨‹åº**ï¼Œè€ƒè™‘ï¼š
- âœ… å¼€å‘æµç¨‹ï¼ˆå¦‚ä½•å¼€å‘ï¼‰
- âœ… æ‰§è¡Œæµç¨‹ï¼ˆå¦‚ä½•è¿è¡Œï¼‰
- âœ… éƒ¨ç½²æµç¨‹ï¼ˆå¦‚ä½•å‘å¸ƒï¼‰
- âœ… ä¸å½±å“ç½‘é¡µç‰ˆ

## ğŸ“ é¡¹ç›®ç»“æ„è®¾è®¡

### æ¨èæ–¹æ¡ˆï¼šMonorepoï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰

```
psongoal/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/                    # å…±äº«ä¸šåŠ¡é€»è¾‘åŒ…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ system-state.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ insights.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚   â””â”€â”€ db-interface.ts  # æ•°æ®åº“æŠ½è±¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â”œâ”€â”€ web/                     # ç½‘é¡µç‰ˆï¼ˆç°æœ‰é¡¹ç›®ï¼‰
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â””â”€â”€ db/
â”‚   â”‚   â”‚       â””â”€â”€ supabase-adapter.ts  # Supabase é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ next.config.js
â”‚   â”‚
â”‚   â”œâ”€â”€ mobile/                  # Appï¼ˆReact Nativeï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â””â”€â”€ db/
â”‚   â”‚   â”‚       â””â”€â”€ sqlite-adapter.ts    # SQLite é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ android/
â”‚   â”‚   â”œâ”€â”€ ios/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ app.json
â”‚   â”‚
â”‚   â”œâ”€â”€ desktop/                 # exeï¼ˆElectronï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ renderer/        # React UI
â”‚   â”‚   â”‚   â”œâ”€â”€ main/             # Electron ä¸»è¿›ç¨‹
â”‚   â”‚   â”‚   â””â”€â”€ db/
â”‚   â”‚   â”‚       â””â”€â”€ sqlite-adapter.ts    # SQLite é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ electron-builder.config.js
â”‚   â”‚
â”‚   â””â”€â”€ miniprogram/             # å¾®ä¿¡å°ç¨‹åº
â”‚       â”œâ”€â”€ pages/
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ utils/
â”‚       â”‚   â””â”€â”€ supabase-adapter.ts      # Supabase é€‚é…å™¨
â”‚       â”œâ”€â”€ app.json
â”‚       â””â”€â”€ project.config.json
â”‚
â”œâ”€â”€ scripts/                     # å…±äº«è„šæœ¬
â”‚   â”œâ”€â”€ build-all.sh
â”‚   â”œâ”€â”€ deploy-web.sh
â”‚   â”œâ”€â”€ deploy-mobile.sh
â”‚   â””â”€â”€ deploy-desktop.sh
â”‚
â”œâ”€â”€ package.json                 # æ ¹ package.jsonï¼ˆworkspaceï¼‰
â”œâ”€â”€ pnpm-workspace.yaml          # æˆ– yarn/npm workspaces
â””â”€â”€ README.md
```

## ğŸ”§ å¼€å‘æµç¨‹

### 1. åˆå§‹åŒ– Monorepo

```bash
# å®‰è£… pnpmï¼ˆæ¨èï¼‰æˆ–ä½¿ç”¨ yarn/npm workspaces
npm install -g pnpm

# åˆ›å»ºæ ¹ package.json
{
  "name": "psongoal-monorepo",
  "private": true,
  "workspaces": [
    "packages/*"
  ],
  "scripts": {
    "dev:web": "pnpm --filter web dev",
    "dev:mobile": "pnpm --filter mobile start",
    "dev:desktop": "pnpm --filter desktop dev",
    "build:web": "pnpm --filter web build",
    "build:mobile": "pnpm --filter mobile build",
    "build:desktop": "pnpm --filter desktop build",
    "build:core": "pnpm --filter core build"
  }
}
```

### 2. å¼€å‘å„å¹³å°

#### ç½‘é¡µç‰ˆå¼€å‘
```bash
# è¿›å…¥ç½‘é¡µç‰ˆç›®å½•
cd packages/web

# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘
pnpm dev
# æˆ–ä»æ ¹ç›®å½•
pnpm dev:web
```

#### App å¼€å‘
```bash
# è¿›å…¥ App ç›®å½•
cd packages/mobile

# å®‰è£…ä¾èµ–
pnpm install

# iOS å¼€å‘
pnpm ios

# Android å¼€å‘
pnpm android

# æˆ–ä»æ ¹ç›®å½•
pnpm dev:mobile
```

#### exe å¼€å‘
```bash
# è¿›å…¥æ¡Œé¢ç‰ˆç›®å½•
cd packages/desktop

# å®‰è£…ä¾èµ–
pnpm install

# å¼€å‘
pnpm dev

# æˆ–ä»æ ¹ç›®å½•
pnpm dev:desktop
```

#### å°ç¨‹åºå¼€å‘
```bash
# è¿›å…¥å°ç¨‹åºç›®å½•
cd packages/miniprogram

# ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ‰“å¼€
# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·
```

### 3. å…±äº«é€»è¾‘å¼€å‘

```bash
# è¿›å…¥æ ¸å¿ƒåŒ…ç›®å½•
cd packages/core

# å¼€å‘å…±äº«é€»è¾‘
# ä¿®æ”¹åï¼Œå…¶ä»–å¹³å°ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°ç‰ˆæœ¬ï¼ˆå¦‚æœä½¿ç”¨ workspaceï¼‰
```

## ğŸš€ æ‰§è¡Œæµç¨‹

### ç½‘é¡µç‰ˆæ‰§è¡Œ

```bash
# å¼€å‘ç¯å¢ƒ
cd packages/web
pnpm dev
# è®¿é—® http://localhost:3000

# ç”Ÿäº§ç¯å¢ƒ
pnpm build
pnpm start
```

### App æ‰§è¡Œ

```bash
# iOS
cd packages/mobile
pnpm ios
# åœ¨ iOS æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºä¸Šè¿è¡Œ

# Android
pnpm android
# åœ¨ Android æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºä¸Šè¿è¡Œ
```

### exe æ‰§è¡Œ

```bash
# å¼€å‘ç¯å¢ƒ
cd packages/desktop
pnpm dev
# æ‰“å¼€ Electron çª—å£

# ç”Ÿäº§ç¯å¢ƒ
pnpm build
# ç”Ÿæˆ exe æ–‡ä»¶
```

### å°ç¨‹åºæ‰§è¡Œ

```bash
# ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·
# 1. æ‰“å¼€å¾®ä¿¡å¼€å‘è€…å·¥å…·
# 2. å¯¼å…¥ packages/miniprogram ç›®å½•
# 3. ç‚¹å‡»"ç¼–è¯‘"è¿è¡Œ
```

## ğŸ“¦ éƒ¨ç½²æµç¨‹

### 1. ç½‘é¡µç‰ˆéƒ¨ç½²

#### Zeabur éƒ¨ç½²
```bash
# 1. æ„å»º
cd packages/web
pnpm build

# 2. éƒ¨ç½²ï¼ˆZeabur è‡ªåŠ¨æ£€æµ‹ Next.jsï¼‰
# åœ¨ Zeabur Dashboard è¿æ¥ GitHub ä»“åº“
# é€‰æ‹© packages/web ç›®å½•
# é…ç½®ç¯å¢ƒå˜é‡
# è‡ªåŠ¨éƒ¨ç½²
```

#### Vercel éƒ¨ç½²
```bash
# 1. åœ¨ Vercel ä¸­å¯¼å…¥é¡¹ç›®
# 2. è®¾ç½®æ ¹ç›®å½•ä¸º packages/web
# 3. é…ç½®ç¯å¢ƒå˜é‡
# 4. è‡ªåŠ¨éƒ¨ç½²
```

### 2. App éƒ¨ç½²

#### iOS éƒ¨ç½²
```bash
# 1. æ„å»º
cd packages/mobile
pnpm build:ios

# 2. ä½¿ç”¨ Xcode
# - æ‰“å¼€ ios/psongoal.xcworkspace
# - é€‰æ‹©è®¾å¤‡/æ¨¡æ‹Ÿå™¨
# - Product > Archive
# - ä¸Šä¼ åˆ° App Store Connect

# 3. æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
fastlane ios release
```

#### Android éƒ¨ç½²
```bash
# 1. æ„å»º
cd packages/mobile
pnpm build:android

# 2. ç”Ÿæˆ APK/AAB
cd android
./gradlew assembleRelease
# æˆ–
./gradlew bundleRelease

# 3. ä¸Šä¼ åˆ° Google Play Console
```

### 3. exe éƒ¨ç½²

#### Windows exe
```bash
# 1. æ„å»º
cd packages/desktop
pnpm build

# 2. æ‰“åŒ…ï¼ˆä½¿ç”¨ electron-builderï¼‰
pnpm build:win
# ç”Ÿæˆ .exe å®‰è£…åŒ…

# 3. åˆ†å‘
# - ä¸Šä¼ åˆ°ç½‘ç«™
# - æˆ–ä½¿ç”¨è‡ªåŠ¨æ›´æ–°æœåŠ¡
```

#### Mac app
```bash
# 1. æ„å»º
cd packages/desktop
pnpm build

# 2. æ‰“åŒ…
pnpm build:mac
# ç”Ÿæˆ .dmg æˆ– .app

# 3. åˆ†å‘
# - ä¸Šä¼ åˆ°ç½‘ç«™
# - æˆ–æäº¤åˆ° Mac App Store
```

### 4. å°ç¨‹åºéƒ¨ç½²

```bash
# 1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­
# 2. ç‚¹å‡»"ä¸Šä¼ "
# 3. å¡«å†™ç‰ˆæœ¬å·å’Œå¤‡æ³¨
# 4. ä¸Šä¼ åˆ°å¾®ä¿¡æœåŠ¡å™¨

# 5. åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°
# - ç™»å½•å°ç¨‹åºåå°
# - ç‰ˆæœ¬ç®¡ç† > å¼€å‘ç‰ˆæœ¬
# - æäº¤å®¡æ ¸
# - å®¡æ ¸é€šè¿‡åå‘å¸ƒ
```

## ğŸ”„ CI/CD æµç¨‹

### GitHub Actions é…ç½®

```yaml
# .github/workflows/deploy.yml
name: Deploy All Platforms

on:
  push:
    branches: [main]

jobs:
  deploy-web:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install
      - run: pnpm --filter web build
      - name: Deploy to Zeabur
        # Zeabur éƒ¨ç½²æ­¥éª¤

  build-mobile:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install
      - run: pnpm --filter mobile build:android
      - name: Upload APK
        # ä¸Šä¼  APK åˆ° GitHub Releases

  build-desktop:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [windows-latest, macos-latest]
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install
      - run: pnpm --filter desktop build
      - name: Upload Artifacts
        # ä¸Šä¼ æ„å»ºäº§ç‰©
```

## ğŸ“‹ å¼€å‘å·¥ä½œæµ

### æ—¥å¸¸å¼€å‘

```bash
# 1. å¼€å‘å…±äº«é€»è¾‘
cd packages/core
# ä¿®æ”¹ä»£ç 
pnpm build

# 2. å¼€å‘ç½‘é¡µç‰ˆ
cd packages/web
pnpm dev
# æµ‹è¯•ç½‘é¡µç‰ˆ

# 3. å¼€å‘ App
cd packages/mobile
pnpm ios
# æµ‹è¯• App

# 4. å¼€å‘ exe
cd packages/desktop
pnpm dev
# æµ‹è¯•æ¡Œé¢ç‰ˆ
```

### å‘å¸ƒæµç¨‹

```bash
# 1. æ›´æ–°ç‰ˆæœ¬å·
# packages/core/package.json
# packages/web/package.json
# packages/mobile/package.json
# packages/desktop/package.json

# 2. æ„å»ºæ‰€æœ‰å¹³å°
pnpm build:core
pnpm build:web
pnpm build:mobile
pnpm build:desktop

# 3. éƒ¨ç½²
# - ç½‘é¡µç‰ˆï¼šè‡ªåŠ¨éƒ¨ç½²ï¼ˆZeabur/Vercelï¼‰
# - Appï¼šæ‰‹åŠ¨ä¸Šä¼ åˆ°åº”ç”¨å•†åº—
# - exeï¼šæ‰‹åŠ¨ä¸Šä¼ åˆ°ç½‘ç«™
# - å°ç¨‹åºï¼šæ‰‹åŠ¨ä¸Šä¼ åˆ°å¾®ä¿¡
```

## ğŸ› ï¸ å·¥å…·å’Œé…ç½®

### 1. åŒ…ç®¡ç†

**æ¨èä½¿ç”¨ pnpm**ï¼ˆæ›´å¿«ï¼ŒèŠ‚çœç©ºé—´ï¼‰

```bash
# å®‰è£… pnpm
npm install -g pnpm

# åˆå§‹åŒ– workspace
pnpm init

# å®‰è£…æ‰€æœ‰ä¾èµ–
pnpm install

# å®‰è£…ç‰¹å®šåŒ…ä¾èµ–
pnpm --filter web install
```

### 2. æ„å»ºå·¥å…·

#### ç½‘é¡µç‰ˆ
- Next.js è‡ªå¸¦æ„å»ºå·¥å…·
- `pnpm build` å³å¯

#### App
- React Native CLI
- `pnpm build:ios` / `pnpm build:android`

#### exe
- Electron Builder
- `pnpm build:win` / `pnpm build:mac`

### 3. ç¯å¢ƒå˜é‡

#### ç½‘é¡µç‰ˆ
```env
# packages/web/.env.local
NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
```

#### App/exe
```env
# packages/mobile/.env
# packages/desktop/.env
# ä¸éœ€è¦ Supabase é…ç½®ï¼ˆä½¿ç”¨æœ¬åœ°æ•°æ®åº“ï¼‰
```

#### å°ç¨‹åº
```env
# packages/miniprogram/.env
# éœ€è¦ Supabase é…ç½®ï¼ˆå’Œç½‘é¡µç‰ˆä¸€æ ·ï¼‰
```

## ğŸ“Š éƒ¨ç½²æ£€æŸ¥æ¸…å•

### ç½‘é¡µç‰ˆéƒ¨ç½²
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®
- [ ] æ„å»ºæˆåŠŸ
- [ ] æµ‹è¯•ç”Ÿäº§ç¯å¢ƒ
- [ ] æ£€æŸ¥æ€§èƒ½
- [ ] æ£€æŸ¥åŠŸèƒ½

### App éƒ¨ç½²
- [ ] iOS: è¯ä¹¦é…ç½®
- [ ] iOS: App Store Connect é…ç½®
- [ ] Android: ç­¾åé…ç½®
- [ ] Android: Google Play Console é…ç½®
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
- [ ] æäº¤å®¡æ ¸

### exe éƒ¨ç½²
- [ ] Windows: ä»£ç ç­¾åï¼ˆå¯é€‰ï¼‰
- [ ] Mac: ä»£ç ç­¾åï¼ˆå¯é€‰ï¼‰
- [ ] æµ‹è¯•å®‰è£…åŒ…
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
- [ ] ä¸Šä¼ åˆ°åˆ†å‘å¹³å°

### å°ç¨‹åºéƒ¨ç½²
- [ ] å°ç¨‹åºé…ç½®æ­£ç¡®
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
- [ ] ä¸Šä¼ ä»£ç 
- [ ] æäº¤å®¡æ ¸
- [ ] å‘å¸ƒ

## ğŸ¯ æ¨èå®æ–½æ­¥éª¤

### é˜¶æ®µ 1: å‡†å¤‡ Monorepoï¼ˆ1å‘¨ï¼‰

1. **åˆ›å»º Monorepo ç»“æ„**
   ```bash
   # åˆ›å»ºç›®å½•ç»“æ„
   mkdir -p packages/{core,web,mobile,desktop,miniprogram}
   ```

2. **ç§»åŠ¨ç°æœ‰ä»£ç **
   ```bash
   # å°†ç°æœ‰ä»£ç ç§»åˆ° packages/web
   mv app packages/web/
   mv components packages/web/
   mv lib packages/web/
   # ... å…¶ä»–æ–‡ä»¶
   ```

3. **åˆ›å»ºå…±äº«é€»è¾‘åŒ…**
   ```bash
   # åˆ›å»º packages/core
   # æå–ä¸šåŠ¡é€»è¾‘
   ```

4. **é…ç½® workspace**
   ```bash
   # é…ç½® pnpm workspace
   # æµ‹è¯•ç½‘é¡µç‰ˆæ˜¯å¦æ­£å¸¸
   ```

### é˜¶æ®µ 2: å¼€å‘ Appï¼ˆ2-3å‘¨ï¼‰

1. **åˆ›å»º React Native é¡¹ç›®**
2. **å®ç° SQLite é€‚é…å™¨**
3. **ä½¿ç”¨å…±äº«é€»è¾‘**
4. **å®ç° UI**
5. **æµ‹è¯•å’Œä¼˜åŒ–**

### é˜¶æ®µ 3: å¼€å‘ exeï¼ˆ2-3å‘¨ï¼‰

1. **åˆ›å»º Electron é¡¹ç›®**
2. **å®ç° SQLite é€‚é…å™¨**
3. **ä½¿ç”¨å…±äº«é€»è¾‘**
4. **å®ç° UI**
5. **æµ‹è¯•å’Œä¼˜åŒ–**

### é˜¶æ®µ 4: å¼€å‘å°ç¨‹åºï¼ˆ1-2å‘¨ï¼‰

1. **åˆ›å»ºå°ç¨‹åºé¡¹ç›®**
2. **ä½¿ç”¨ Supabase é€‚é…å™¨**
3. **ä½¿ç”¨å…±äº«é€»è¾‘**
4. **å®ç°å°ç¨‹åº UI**
5. **æµ‹è¯•å’Œä¼˜åŒ–**

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. ç‰ˆæœ¬ç®¡ç†

- å„å¹³å°ç‹¬ç«‹ç‰ˆæœ¬å·
- å…±äº«é€»è¾‘åŒ…ç‹¬ç«‹ç‰ˆæœ¬
- ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼ˆsemverï¼‰

### 2. ä¾èµ–ç®¡ç†

- å…±äº«ä¾èµ–æ”¾åœ¨æ ¹ç›®å½•
- å¹³å°ç‰¹å®šä¾èµ–æ”¾åœ¨å„è‡ªåŒ…
- ä½¿ç”¨ workspace é“¾æ¥

### 3. æ„å»ºé¡ºåº

- å…ˆæ„å»ºå…±äº«é€»è¾‘åŒ…
- å†æ„å»ºå„å¹³å°
- ç¡®ä¿ä¾èµ–æ­£ç¡®

### 4. æµ‹è¯•

- æ¯ä¸ªå¹³å°ç‹¬ç«‹æµ‹è¯•
- å…±äº«é€»è¾‘ç»Ÿä¸€æµ‹è¯•
- é›†æˆæµ‹è¯•ï¼ˆå¯é€‰ï¼‰

## ğŸ¯ æ€»ç»“

**é¡¹ç›®ç»“æ„**ï¼š
- Monorepoï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰
- å…±äº«é€»è¾‘ï¼ˆcore åŒ…ï¼‰
- å„å¹³å°ç‹¬ç«‹ï¼ˆweb/mobile/desktop/miniprogramï¼‰

**å¼€å‘æµç¨‹**ï¼š
- å„å¹³å°ç‹¬ç«‹å¼€å‘
- å…±äº«é€»è¾‘ç»Ÿä¸€ç»´æŠ¤
- ä½¿ç”¨ workspace é“¾æ¥

**éƒ¨ç½²æµç¨‹**ï¼š
- ç½‘é¡µç‰ˆï¼šè‡ªåŠ¨éƒ¨ç½²ï¼ˆZeabur/Vercelï¼‰
- Appï¼šæ‰‹åŠ¨ä¸Šä¼ åº”ç”¨å•†åº—
- exeï¼šæ‰‹åŠ¨ä¸Šä¼ ç½‘ç«™
- å°ç¨‹åºï¼šæ‰‹åŠ¨ä¸Šä¼ å¾®ä¿¡

**å¥½å¤„**ï¼š
- âœ… ä¸å½±å“ç½‘é¡µç‰ˆ
- âœ… ä»£ç å¯ä»¥å…±äº«
- âœ… å„å¹³å°ç‹¬ç«‹éƒ¨ç½²
- âœ… ç»Ÿä¸€ç®¡ç†

---

**å‘Šè¯‰æˆ‘æ˜¯å¦å¼€å§‹å®æ–½ï¼Œæˆ‘ä¼šé€æ­¥å®Œæˆï¼**

